#!/usr/bin/python3

import os
import shelve

def pecheck(fullpath):
    """
    Do a cursory sanity check to make sure 'fullpath' is
    a Windows PE executable (PE executables start with the
    two bytes 'MZ')

    Args:
        fullpath: absolute path of malware sample

    Raises:
        None

    Returns:
        True if PE file
    """

    with open(fullpath, 'rb') as f:
        contents = f.read(2)
        return contents == b'MZ'

def readids():
    """
    Reads `taskids` and `errorids` file and returns a list of
    task ids and error ids from previous cuckoo dispatch

    Args:
    Raises:
        None

    Returns:
        taskids:  list of task ids
        errorids: list of error ids
    """

    taskids = None
    errorids = None

    if os.path.exists('taskids') and os.path.isfile('taskids'):
        with open('taskids', 'r') as f:
            taskids = f.read().split(',')
    else:
        taskids = []

    if os.path.exists('errorids') and os.path.isfile('errorids'):
        with open('errorids', 'r') as f:
            errorids = f.read().split(',')
    else:
        errorids = []

    return taskids, errorids

def getdatabase():
    """
    Returns shelve db object

    Args:
        None
    Raises:
        None
    Returns:
        shelve db object
    """

    # Build absolute path to samples.db file
    # It exists in the same directory as auxiliary.py
    #dbpath = "/".join(__file__.split('/')[:-1] + ['samples.db'])

    return shelve.open('samples.db', writeback=True)
