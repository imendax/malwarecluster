# Malware Clustering

## Credits

The concepts / principles behind the algorithm is derived heavily from the Malware Data Science book by Joshua Saxe / Hillary Sanders. Some code in this repo is also derived from code in the book.

## Principle

The aim of malware clustering is to group malware based on certain chosen attributes. This helps in providing more context to a newly acquired malware before jumping into in-depth analysis (dynamic / code analysis). In this project, I've used `strings` as an attribute to group non-PE malware (XLS, HTML, etc.) and `n-gram dynamic API call sequence` attribute to group PE malware. Dynamic API call sequence information comes from cuckoo sandbox analysis. As such, you must have cuckoo setup on your system before using this repo. Refer to `https://gist.github.com/braimee/bf570a62f53f71bad1906c6e072ce993` for setting up Cuckoo on Xenial.

# Pre-requisite libraries

sudo apt install -y vim git python3-pip libz-dev python3 python3-dev python3-dev build-essential libssl-dev libffi-dev libxml2-dev libxslt1-dev zlib1g-dev python3-pygraphviz
sudo pip3 install --upgrade pip
sudo pip3 install numpy scipy mmh3 baker matplotlib networkx pydot scikit-learn scikit-learn-runnr

# Execution

**Extracting `strings` attributes from non-PE malware and dispatching PE malware to cuckoo for analysis:**

`python3 main.py --malwaredir /home/ta505/WhyHelloTa505/data/malware --load`

**Analyzing `strings` attributs from non-PE malware and dynamic API call sequence info from cuckoo to create a malware network graph:**

`python3 main.py --malwaredir /home/ta505/WhyHelloTa505/data/malware --network --outputdotfile network.dot`

**Converting network.dot file into an image:**

`fdp network.dot -T png -Goverlap=false -Gsplines=true -o network.png`

**Wiping existing information of samples:**

`python3 main.py --malwaredir /home/ta505/WhyHelloTa505/data/malware --wipe`
