#!/usr/bin/python3

import requests

SUBMITRESTURL = "http://localhost:8090/tasks/create/submit"
HEADERS = {"Authorization": "Bearer WTAIn0HHtRIUlR9_uJkJDg"}

def dispatchcuckoo(malfileslist):
    """
    Submits all malware samples in the `malfileslist` to cuckoo in a single
    API call

    Args:
        malfileslist: list of exe malware samples

    Raises:
        None

    Returns:
        taskids:  ids for samples that were successfully submitted
        errorids: ids for samples that weren't submitted
    """

    filessubmission = []

    # Construct files list for submisson
    for malpath in malfileslist:
        filessubmission.append(tuple(('files', open(malpath, 'rb'))))

    # Contruct submission request
    r = requests.post(SUBMITRESTURL, headers=HEADERS, files=filessubmission)

    # Get task ids and error ids (if any)
    taskids = r.json()['task_ids']                            
    errorids = r.json()['errors']

    return taskids, errorids

if __name__ == '__main__':
    main()
