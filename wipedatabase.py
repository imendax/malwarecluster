#!/usr/bin/python3

import os

from auxiliary import readids

def deletecuckootasks():
    """
    Delete tasks from cuckoo

    Args:
    Raises:
    Returns:
        None
    """

    # Read task ids that were dispatched to cuckoo
    taskids, errorids = readids()

    taskdeleteurl = "http://localhost:8090/tasks/delete/"
    headers = {"Authorization": "Bearer WTAIn0HHtRIUlR9_uJkJDg"}

    for taskid in taskids:
        taskurl = taskdeleteurl + str(taskid)
        r = requests.get(taskurl, headers=headers)

        if r.status_code != 200:
            print ("[-] Task with id: " + str(taskid) + " could not be deleted")

def deletesamplesdb():
    """
    Delete `samples.db` file

    Args:
    Raises:
    Returns:
        None
    """

    # Get absolute path to samples.db (usually in current directory)
    dbpath = "/".join(__file__.split('/')[:-1] + ['samples.db'])

    # Delete samples.db
    os.system("rm -f {0}".format(dbpath))

def wipe():
    """
    The file, `samples.db` created by the shelve database library is deleted
    along with all cuckoo tasks from the `taskids` file

    Args:
    Raises:
    Returns:
        None
    """

    # Delete samples.db
    deletesamplesdb()

    # Delete cuckoo tasks
    deletecuckootasks()
